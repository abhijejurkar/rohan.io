<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contact Us - Vision of Home</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital,wght@0,400;1,400&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Montserrat', Arial, sans-serif;
      background: linear-gradient(135deg, #1a2238 0%, #283655 100%);
      color: #fff;
      min-height: 100vh;
      min-width: 100vw;
      box-sizing: border-box;
      text-align: center;
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
    }
    body::-webkit-scrollbar { display: none; }
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: 0;
      pointer-events: none;
      background-image: linear-gradient(rgba(0,255,255,0.07) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(0,255,255,0.07) 1px, transparent 1px);
      background-size: 40px 40px;
      animation: gridMove 8s linear infinite;
    }
    @keyframes gridMove {
      0% { background-position: 0 0, 0 0; }
      100% { background-position: 40px 40px, 40px 40px; }
    }
    .floating-contact-btn {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 9999;
      background: linear-gradient(135deg, #21e6c1 60%, #ff6a3d 100%);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 54px;
      height: 54px;
      box-shadow: 0 4px 24px #21e6c155;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.7rem;
      cursor: pointer;
      transition: box-shadow 0.2s, transform 0.18s;
      animation: contactBtnPulse 2.2s infinite;
      min-width: 44px;
      min-height: 44px;
      touch-action: manipulation;
      outline: none;
      will-change: transform, opacity;
    }
    .floating-contact-btn.open { z-index: 10001; }
    .floating-contact-btn:hover, .floating-contact-btn:focus {
      box-shadow: 0 8px 32px #ff6a3d88;
      transform: scale(1.08);
      outline: none;
    }
    @keyframes contactBtnPulse {
      0%, 100% { box-shadow: 0 4px 24px #21e6c155; }
      50% { box-shadow: 0 8px 32px #ff6a3d88; }
    }
    .chatbot-contact-modal {
      display: none;
      flex-direction: column;
      align-items: stretch;
      position: fixed;
      bottom: 86px;
      right: 24px;
      z-index: 10000;
      background: #1a2238;
      border-radius: 18px 18px 18px 6px;
      box-shadow: 0 8px 32px #21e6c180;
      width: 340px;
      max-width: 98vw;
      overflow: hidden;
      font-family: 'Montserrat', Arial, sans-serif;
      opacity: 0;
      transform: scale(0.7) translateY(40px);
      pointer-events: none;
      transition: opacity 0.38s cubic-bezier(.4,2,.6,1), transform 0.38s cubic-bezier(.4,2,.6,1);
      outline: none;
      min-width: 44px;
      min-height: 44px;
      touch-action: manipulation;
      will-change: transform, opacity;
    }
    .chatbot-contact-modal.open {
      display: flex;
      opacity: 1;
      transform: scale(1) translateY(0);
      pointer-events: auto;
      transition: opacity 0.38s cubic-bezier(.4,2,.6,1), transform 0.38s cubic-bezier(.4,2,.6,1);
    }
    .chatbot-contact-modal.closing {
      opacity: 0;
      transform: scale(0.7) translateY(40px);
      pointer-events: none;
      transition: opacity 0.38s cubic-bezier(.4,2,.6,1), transform 0.38s cubic-bezier(.4,2,.6,1);
    }
    .chatbot-contact-modal:focus {
      outline: 2px solid #21e6c1;
    }
    .chatbot-header {
      background: linear-gradient(90deg, #21e6c1 60%, #ff6a3d 100%);
      color: #fff;
      font-family: 'DM Serif Display', serif;
      font-size: 1.1rem;
      font-weight: 700;
      padding: 0.8em 1.2em;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #21e6c1;
    }
    .chatbot-header .close-btn {
      background: none;
      border: none;
      color: #fff;
      font-size: 1.3rem;
      cursor: pointer;
      margin-left: 0.5em;
      transition: color 0.2s;
    }
    .chatbot-header .close-btn:hover { color: #1a2238; }
    .chatbot-chat-area {
      background: none;
      padding: 1.1em 1.2em 1em 1.2em;
      display: flex;
      flex-direction: column;
      gap: 0.5em;
      min-height: 220px;
      max-height: 320px;
      overflow-y: auto;
      scrollbar-width: thin;
    }
    .chatbot-bubble {
      max-width: 85%;
      padding: 0.7em 1em;
      border-radius: 18px 18px 18px 6px;
      margin-bottom: 0.2em;
      font-size: 1.01rem;
      line-height: 1.5;
      opacity: 0;
      transform: translateY(20px) scale(0.98);
      animation: bubbleIn 0.5s forwards;
      box-shadow: 0 2px 10px #21e6c122;
      word-break: break-word;
    }
    .chatbot-bubble.bot {
      background: linear-gradient(90deg, #21e6c1 60%, #ff6a3d 100%);
      color: #fff;
      align-self: flex-start;
      border-bottom-left-radius: 3px;
      animation-delay: 0.1s;
    }
    .chatbot-bubble.user {
      background: #283655;
      color: #fff;
      align-self: flex-end;
      border-bottom-right-radius: 3px;
      animation: bubbleInUser 0.5s forwards;
    }
    @keyframes bubbleIn {
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes bubbleInUser {
      from { opacity: 0; transform: translateY(20px) scale(0.98); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    .chatbot-typing {
      display: flex;
      align-items: center;
      gap: 0.2em;
      margin: 0.2em 0 0.2em 0.1em;
      min-height: 24px;
      opacity: 0.7;
    }
    .chatbot-typing-dot {
      width: 7px;
      height: 7px;
      background: #21e6c1;
      border-radius: 50%;
      display: inline-block;
      animation: typingDot 1s infinite;
    }
    .chatbot-typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .chatbot-typing-dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes typingDot {
      0%, 80%, 100% { opacity: 0.3; transform: scale(1); }
      40% { opacity: 1; transform: scale(1.3); }
    }
    .chatbot-input-area {
      display: flex;
      align-items: center;
      gap: 0.5em;
      padding: 0.7em 1.2em 1em 1.2em;
      background: none;
      border-top: 1px solid #223b5a;
    }
    .chatbot-input {
      flex: 1;
      padding: 0.7em 1em;
      border: none;
      border-radius: 999px;
      background: #223b5a;
      color: #fff;
      font-size: 1.01rem;
      font-family: 'Montserrat', Arial, sans-serif;
      outline: none;
      box-shadow: 0 2px 10px #21e6c122;
      transition: box-shadow 0.2s, background 0.2s;
    }
    .chatbot-input:focus {
      background: #283655;
      box-shadow: 0 4px 18px #21e6c155;
    }
    .chatbot-send-btn {
      background: #ff6a3d;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 38px;
      height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      cursor: pointer;
      transition: background 0.2s, transform 0.15s;
      box-shadow: 0 2px 10px #ff6a3d33;
    }
    .chatbot-send-btn:hover, .chatbot-send-btn:focus {
      background: #d95a27;
      transform: scale(1.08);
    }
    @media (max-width: 600px) {
      .floating-contact-btn { right: 8px; bottom: 8px; width: 44px; height: 44px; font-size: 1.1rem; }
      .chatbot-contact-modal { right: 0; left: 0; bottom: 0; width: 100vw; max-width: 100vw; border-radius: 0; min-width: 44px; min-height: 44px; }
      .chatbot-header { font-size: 0.98rem; padding: 0.7em 0.7em; }
    }
  </style>
</head>
<body>
  <button class="floating-contact-btn" id="floatingContactBtn" title="Ask Riya" aria-label="Ask Riya">
    <svg width="28" height="28" viewBox="0 0 32 32" fill="none"><circle cx="16" cy="16" r="16" fill="#21e6c1" opacity="0.18"/><path d="M8 12v8a2 2 0 002 2h12a2 2 0 002-2v-8a2 2 0 00-2-2H10a2 2 0 00-2 2z" stroke="#fff" stroke-width="2"/><path d="M8 12l8 6 8-6" stroke="#ff6a3d" stroke-width="2"/></svg>
  </button>
  <div class="chatbot-contact-modal" id="chatbotContactModal" tabindex="0">
    <div class="chatbot-header">
      Ask Riya
      <button class="close-btn" id="chatbotModalClose" title="Close">&times;</button>
    </div>
    <div class="chatbot-chat-area" id="chatbotChatArea" aria-live="polite"></div>
    <form class="chatbot-input-area" id="chatbotInputForm" autocomplete="off" style="display:none;">
      <input type="text" class="chatbot-input" id="chatbotInput" placeholder="Type here..." autocomplete="off" />
      <button type="submit" class="chatbot-send-btn" title="Send">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 12l18-7-7 18-2-8-8-3z" fill="#fff"/></svg>
      </button>
    </form>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>
    // Initialize EmailJS - Replace with your actual public key
    (function() {
      emailjs.init("gpolW7ZWHFOcbsAwo"); // Replace with your EmailJS public key (starts with 'user_')
    })();

    const contactBtn = document.getElementById('floatingContactBtn');
    const chatbotModal = document.getElementById('chatbotContactModal');
    const chatbotClose = document.getElementById('chatbotModalClose');
    const chatArea = document.getElementById('chatbotChatArea');
    const inputForm = document.getElementById('chatbotInputForm');
    const inputBox = document.getElementById('chatbotInput');
    let isOpen = false;
    let chatStep = 0;
    let userData = { name: '', mobile: '', message: '' };
    let animating = false;

    // Helper: Add chat bubble
    function addBubble(text, sender = 'bot', delay = 0) {
      setTimeout(() => {
        const bubble = document.createElement('div');
        bubble.className = 'chatbot-bubble ' + sender;
        bubble.textContent = text;
        chatArea.appendChild(bubble);
        setTimeout(() => {
          bubble.style.opacity = 1;
          bubble.style.transform = 'translateY(0) scale(1)';
          chatArea.scrollTop = chatArea.scrollHeight;
        }, 10);
        // Always scroll to latest
        chatArea.scrollTo({ top: chatArea.scrollHeight, behavior: 'smooth' });
        // Always focus input if visible
        if (inputForm.style.display !== 'none') {
          setTimeout(() => { inputBox.focus(); }, 100);
        }
      }, delay);
    }
    // Helper: Typing indicator
    function showTyping(delay = 600) {
      return new Promise(resolve => {
        const typing = document.createElement('div');
        typing.className = 'chatbot-typing';
        typing.innerHTML = '<span class="chatbot-typing-dot"></span><span class="chatbot-typing-dot"></span><span class="chatbot-typing-dot"></span>';
        chatArea.appendChild(typing);
        chatArea.scrollTop = chatArea.scrollHeight;
        setTimeout(() => {
          typing.remove();
          resolve();
        }, delay);
      });
    }
    // Proactively load voices on page load
    window.addEventListener('DOMContentLoaded', function() {
      if ('speechSynthesis' in window) {
        // Load voices immediately
        window.speechSynthesis.getVoices();
        
        // Listen for voices to be loaded
        window.speechSynthesis.addEventListener('voiceschanged', function() {
          console.log('Voices loaded:', window.speechSynthesis.getVoices().length);
        });
        
        // Try to speak a dummy utterance to initialize
        setTimeout(() => {
          try {
            var dummy = new window.SpeechSynthesisUtterance('');
            dummy.volume = 0;
            window.speechSynthesis.speak(dummy);
          } catch (e) {
            console.log('Speech synthesis initialization:', e);
          }
        }, 100);
      }
    });
    // Chatbot flow
    async function startChat() {
      chatArea.innerHTML = '';
      chatStep = 0;
      userData = { name: '', mobile: '', message: '' };
      inputForm.style.display = 'none';
      chatbotModal.focus();
      
      // Time-based greeting
      var now = new Date();
      var hour = now.getHours();
      var greeting = 'Hello';
      if (hour < 12) greeting = 'Good morning';
      else if (hour < 18) greeting = 'Good afternoon';
      else greeting = 'Good evening';
      
      const greetingText = greeting + ", I am Riya, Rohan's assistant. Welcome to Vision of Home! 👋";
      
      // Add greeting bubble and speak it
      addBubble(greetingText, 'bot', 100);
      
      // Wait a bit for the bubble to appear, then speak
      setTimeout(() => {
        speakBot(greetingText);
      }, 300);
      
      // Wait longer before showing typing and asking for name
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      await showTyping(900);
      addBubble('May I know your name?', 'bot', 100);
      speakBot('May I know your name?');
      chatStep = 1;
      inputForm.style.display = 'flex';
      inputBox.type = 'text';
      inputBox.value = '';
      inputBox.placeholder = 'Your name...';
      setTimeout(() => { inputBox.focus(); }, 200);
    }
    async function handleUserInput(input) {
      if (chatStep === 1) {
        userData.name = input;
        addBubble(input, 'user', 100);
        inputForm.style.display = 'none';
        await showTyping(800);
        addBubble(`Nice to meet you, ${userData.name}! Can I have your mobile number?`, 'bot', 100);
        speakBot(`Nice to meet you, ${userData.name}! Can I have your mobile number?`);
        chatStep = 2;
        inputForm.style.display = 'flex';
        inputBox.type = 'tel';
        inputBox.value = '';
        inputBox.placeholder = 'Your mobile number...';
        setTimeout(() => { inputBox.focus(); }, 200);
      } else if (chatStep === 2) {
        if (!/^\d{10,15}$/.test(input.replace(/\D/g, ''))) {
          addBubble('Please enter a valid mobile number (10-15 digits).', 'bot', 100);
          speakBot('Please enter a valid mobile number.');
          setTimeout(() => { inputBox.focus(); }, 200);
          return;
        }
        userData.mobile = input.replace(/\D/g, '');
        addBubble(userData.mobile, 'user', 100);
        inputForm.style.display = 'none';
        await showTyping(800);
        addBubble('What would you like to share with us today?', 'bot', 100);
        speakBot('What would you like to share with us today?');
        chatStep = 3;
        inputForm.style.display = 'flex';
        inputBox.type = 'text';
        inputBox.value = '';
        inputBox.placeholder = 'Your message...';
        setTimeout(() => { inputBox.focus(); }, 200);
      } else if (chatStep === 3) {
        userData.message = input;
        addBubble(userData.message, 'user', 100);
        inputForm.style.display = 'none';
        await showTyping(900);
        addBubble('Sending your message...', 'bot', 100);
        speakBot('Sending your message...');
        
        // Send email
        try {
          const response = await sendEmail(userData);
          if (response.success) {
            addBubble('Perfect! Your message has been sent successfully. We\'ll contact you soon. Have a wonderful day! 🌸', 'bot', 100);
            speakBot('Perfect! Your message has been sent successfully. We\'ll contact you soon. Have a wonderful day!');
          } else {
            addBubble('Sorry, there was an issue sending your message. Please try again or contact us directly.', 'bot', 100);
            speakBot('Sorry, there was an issue sending your message. Please try again.');
          }
        } catch (error) {
          console.error('Email error:', error);
          addBubble('Sorry, there was an issue sending your message. Please try again or contact us directly.', 'bot', 100);
          speakBot('Sorry, there was an issue sending your message. Please try again.');
        }
        
        chatStep = 4;
        setTimeout(() => {
          chatbotModal.classList.remove('open');
          chatbotModal.classList.add('closing');
          contactBtn.classList.remove('open');
          isOpen = false;
          setTimeout(() => {
            chatbotModal.classList.remove('closing');
            chatbotModal.style.display = 'none';
          }, 400);
        }, 4000);
      }
    }
    // Open/close logic
    contactBtn.addEventListener('click', () => {
      if (animating) return;
      animating = true;
      isOpen = !isOpen;
      if (isOpen) {
        chatbotModal.classList.remove('closing');
        chatbotModal.style.display = 'flex';
        setTimeout(() => {
          chatbotModal.classList.add('open');
          contactBtn.classList.add('open');
          document.body.style.overflowX = 'hidden';
          setTimeout(startChat, 200);
          setTimeout(() => { animating = false; }, 400);
        }, 10);
      } else {
        chatbotModal.classList.remove('open');
        chatbotModal.classList.add('closing');
        contactBtn.classList.remove('open');
        document.body.style.overflowX = '';
        setTimeout(() => {
          chatbotModal.classList.remove('closing');
          chatbotModal.style.display = 'none';
          animating = false;
        }, 400);
      }
    });
    chatbotClose.addEventListener('click', () => {
      if (animating) return;
      animating = true;
      chatbotModal.classList.remove('open');
      chatbotModal.classList.add('closing');
      contactBtn.classList.remove('open');
      isOpen = false;
      document.body.style.overflowX = '';
      setTimeout(() => {
        chatbotModal.classList.remove('closing');
        chatbotModal.style.display = 'none';
        animating = false;
      }, 400);
    });
    // Handle input
    inputForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const val = inputBox.value.trim();
      if (!val) return;
      handleUserInput(val);
      inputBox.value = '';
    });
    inputBox.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        inputForm.dispatchEvent(new Event('submit'));
      }
    });
    // Enhanced speech synthesis with retries
    function speakBot(text, retry = 0) {
      // Remove waving hand emoji
      const cleanText = text.replace(/👋/g, '').trim();
      if ('speechSynthesis' in window) {
        const utter = new window.SpeechSynthesisUtterance(cleanText);
        utter.rate = 1;
        utter.pitch = 1;
        utter.volume = 1;
        utter.lang = 'en-US';
        // Try to select a female voice
        const voices = window.speechSynthesis.getVoices();
        const female = voices.find(v => v.lang.startsWith('en') && v.name.toLowerCase().includes('female'))
          || voices.find(v => v.lang.startsWith('en') && v.gender === 'female')
          || voices.find(v => v.lang.startsWith('en') && v.name.toLowerCase().includes('woman'))
          || voices.find(v => v.lang.startsWith('en') && v.name.toLowerCase().includes('zira'))
          || voices.find(v => v.lang.startsWith('en'));
        if (female) utter.voice = female;
        window.speechSynthesis.speak(utter);
      }
    }
    // Function to send email using EmailJS (works with static websites)
    async function sendEmail(data) {
      const templateParams = {
        to_email: "jejurkarabhishek98@gmail.com",
        to_name: "Abhishek",
        from_name: data.name,
        from_mobile: data.mobile,
        message: data.message,
        timestamp: new Date().toLocaleString('en-IN', {
          timeZone: 'Asia/Kolkata',
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        }),
        source: 'Ask Riya Chatbot - Vision of Home'
      };
      
      try {
        const response = await emailjs.send(
          'service_w1h91s9', // Replace with your EmailJS service ID (e.g., service_xxxxxxx)
          'template_ht4zwdf', // Replace with your EmailJS template ID (e.g., template_xxxxxxx)
          templateParams
        );
        
        console.log('Email sent successfully:', response);
        return { success: true, message: 'Email sent successfully' };
      } catch (error) {
        console.error('Email sending failed:', error);
        throw error;
      }
    }
  </script>
</body>
</html>
